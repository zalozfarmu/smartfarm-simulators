<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Device Simulator</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="shared/server-selector.css">
    <script src="https://unpkg.com/mqtt@4.3.7/dist/mqtt.min.js"></script>
    <script src="shared/config.js"></script>
    <script src="shared/server-selector.js"></script>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1>ü§ñ ESP32 Device Simulator</h1>
                <p>Simulace fyzick√©ho SmartCoop za≈ô√≠zen√≠</p>
            </div>
            <div class="header-right">
                <div class="header-nav">
                    <a href="../index.html">üè† √övod</a>
                    <a href="../mqtt-management/index.html">üîß Management</a>
                    <a href="../mqtt-dashboard/index.html">üìä Dashboard</a>
                    <a href="../camera-simulator/index.html">üìπ Camera Sim</a>
                </div>
                <span id="currentUserBadge" class="user-badge" style="display:none; margin-right: 10px;">
                    üë§ <span id="currentUserEmail">-</span>
                    <button class="btn-link" onclick="handleLogout()" style="margin-left:8px;">Logout</button>
                </span>
                <span id="deviceStatus" class="status-badge offline">‚ö´ OFFLINE</span>
            </div>
        </div>

        <div class="server-status-banner" data-server-status></div>

        <!-- Server Selector -->
        <!-- Server Selector -->
        <div class="card" style="margin-bottom: 20px;">
            <h3>üåê V√Ωbƒõr serveru</h3>
            <div class="form-group">
                <label for="serverProfile">Profil serveru</label>
                <select id="serverProfile" class="form-control" onchange="changeServerProfile(this.value)">
                    <option value="local">üêã Lok√°ln√≠ Docker</option>
                    <option value="production">üåê VPS (Produkce)</option>
                    <option value="custom">‚öôÔ∏è Vlastn√≠ nastaven√≠</option>
                </select>
            </div>

            <div id="serverInfo"
                style="margin-top: 10px; padding: 10px; background: #f8fafc; border-radius: 6px; border: 1px solid #e2e8f0;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span style="color: #64748b; font-size: 12px;">MQTT Broker:</span>
                    <code id="mqttUrlDisplay" style="font-size: 12px; color: #0f172a;">-</code>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: #64748b; font-size: 12px;">API:</span>
                    <code id="apiUrlDisplay" style="font-size: 12px; color: #0f172a;">-</code>
                </div>
            </div>
        </div>

        <!-- Connection Card -->
        <div class="card">
            <h2>üîå P≈ôipojen√≠</h2>

            <div class="form-group">
                <label>Za≈ô√≠zen√≠ z Management Console</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="deviceSelect" class="form-control" style="flex: 1;">
                        <option value="">-- Vyberte za≈ô√≠zen√≠ --</option>
                    </select>
                    <button type="button" class="btn btn-secondary btn-small" onclick="refreshDevices()"
                        title="Obnovit seznam za≈ô√≠zen√≠ z API" id="refreshDevicesBtn">
                        üîÑ
                    </button>
                </div>
                <div id="currentDeviceInfo"
                    style="margin-top: 8px; padding: 8px; background: #f0f9ff; border-radius: 6px; display: none;">
                    <small style="color: #0369a1; display: flex; align-items: center; gap: 6px;">
                        <span>‚úÖ</span>
                        <span id="currentDeviceName">-</span>
                        <span style="color: #6b7280;">|</span>
                        <span id="currentDeviceId" style="font-family: monospace;">-</span>
                    </small>
                </div>
                <div id="credentialsStatus" style="margin-top: 8px; padding: 8px; border-radius: 6px; display: none;">
                    <small id="credentialsStatusText" style="display: flex; align-items: center; gap: 6px;"></small>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                    <small style="color: #6b7280; font-size: 12px;">
                        <span id="dataSourceInfo">Naƒç√≠t√°no z API</span> |
                        <span id="tokenStatus" style="color: #9ca3af;">Token: <span id="tokenStatusText">-</span></span>
                    </small>
                    <button type="button" id="logoutBtn" class="btn btn-secondary btn-small" onclick="handleLogout()"
                        style="display: none; font-size: 11px;">
                        üëã Odhl√°sit
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label style="display: flex; justify-content: space-between; align-items: center;">
                    <span>Device ID</span>
                    <button type="button" class="btn btn-secondary btn-small" onclick="toggleCredentialsEdit()"
                        style="font-size: 10px; padding: 2px 8px;" title="Odemknout pro manu√°ln√≠ √∫pravu (testov√°n√≠)">
                        üîì Upravit
                    </button>
                </label>
                <input type="text" id="deviceId" value="" readonly
                    style="background-color: #f9fafb; cursor: not-allowed;">
                <small style="color: #6b7280; font-size: 12px;">üìå Automaticky naƒçteno z vybran√©ho za≈ô√≠zen√≠ v√Ω≈°e</small>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>MQTT Username</label>
                    <input type="text" id="username" value="" readonly
                        style="background-color: #f9fafb; cursor: not-allowed;">
                    <small style="color: #6b7280; font-size: 11px;">üîê Automaticky naƒçteno po autentizaci</small>
                </div>
                <div class="form-group">
                    <label>MQTT Password</label>
                    <input type="text" id="password" value="" readonly
                        style="background-color: #f9fafb; cursor: not-allowed;">
                    <small style="color: #6b7280; font-size: 11px;">üîê Automaticky naƒçteno po autentizaci</small>
                </div>
            </div>

            <div class="button-group">
                <button id="authBtn" class="btn btn-secondary" onclick="handleDeviceAuth()" style="display: none;">
                    üîê Autentizovat za≈ô√≠zen√≠
                </button>
                <button id="syncAclBtn" class="btn btn-secondary" onclick="syncAcl()"
                    title="Synchronizovat ACL - p≈ôid√° v≈°echny existuj√≠c√≠ za≈ô√≠zen√≠ a moduly do ACL souboru">
                    üîÑ Synchronizovat ACL
                </button>
                <button id="connectBtn" class="btn btn-primary" onclick="simulator.connect()">
                    üîå P≈ôipojit
                </button>
                <button id="disconnectBtn" class="btn btn-danger" onclick="simulator.disconnect()"
                    style="display: none;">
                    üîå Odpojit
                </button>
            </div>

            <div id="credentialsInfo"
                style="margin-top: 15px; padding: 10px; background: #f0f9ff; border-radius: 8px; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <small style="color: #0369a1;">
                        üíæ <strong>Credentials ulo≈æeny</strong> - Za≈ô√≠zen√≠ se automaticky p≈ôipoj√≠ p≈ôi dal≈°√≠m spu≈°tƒõn√≠
                    </small>
                    <button type="button" class="btn btn-secondary btn-small" onclick="clearSavedCredentials()"
                        title="Vymazat ulo≈æen√© credentials (pro testov√°n√≠)">
                        üóëÔ∏è Vymazat
                    </button>
                </div>
            </div>
        </div>

        <!-- Device Info Card -->
        <div class="card" id="deviceInfoCard" style="display: none;">
            <h2>‚ÑπÔ∏è Informace o za≈ô√≠zen√≠</h2>

            <div id="deviceOwnerInfo"
                style="margin-bottom: 20px; padding: 12px; background: #f9fafb; border-radius: 8px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <span style="font-weight: 600; color: #374151;">üë§ Vlastn√≠k:</span>
                    <span id="deviceOwnerName" style="color: #1f2937;">-</span>
                </div>
                <div style="font-size: 12px; color: #6b7280;" id="deviceOwnerEmail">-</div>
            </div>

            <div style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3 style="font-size: 16px; color: #1f2937; margin: 0;">üì¶ Moduly p≈ôipojen√© k za≈ô√≠zen√≠</h3>
                    <button type="button" class="btn btn-primary btn-small" onclick="showLinkModuleModal()"
                        id="linkModuleBtn">
                        ‚ûï P≈ôipojit modul
                    </button>
                </div>
                <div id="deviceModulesList" style="min-height: 50px;">
                    <div style="text-align: center; padding: 20px; color: #9ca3af;">
                        <div>‚è≥ Naƒç√≠t√°m moduly...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Link Module Modal -->
        <div id="linkModuleModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚ûï P≈ôipojit modul k za≈ô√≠zen√≠</h2>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Vyberte modul</label>
                        <select id="moduleSelect" class="form-control">
                            <option value="">-- Vyberte modul --</option>
                        </select>
                        <small style="color: #6b7280; font-size: 12px;">Vyberte modul, kter√Ω chcete p≈ôipojit k tomuto
                            za≈ô√≠zen√≠</small>
                    </div>
                    <div id="linkModuleError" style="color: #ef4444; margin-top: 10px; display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideLinkModuleModal()">Zru≈°it</button>
                    <button class="btn btn-primary" onclick="linkModuleToDevice()">‚úÖ P≈ôipojit</button>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="loginModal" class="modal" data-login-required="true">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üîê P≈ôihl√°≈°en√≠</h2>
                </div>
                <div class="modal-body">
                    <p style="margin-bottom: 15px; color: #6b7280;">
                        Pro naƒçten√≠ za≈ô√≠zen√≠ z Management Console je vy≈æadov√°no p≈ôihl√°≈°en√≠.
                    </p>

                    <!-- Quick login buttons -->
                    <div style="margin-bottom: 20px;">
                        <label style="font-size: 12px; color: #6b7280; margin-bottom: 8px; display: block;">‚ö° Rychl√© p≈ôihl√°≈°en√≠:</label>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-secondary btn-small" onclick="fillTestUser('a@a.cz', 'test123')"
                                style="font-size: 12px;">
                                üë§ a@a.cz
                            </button>
                            <button type="button" class="btn btn-secondary btn-small" onclick="fillTestUser('admin@admin.cz', 'admin')"
                                style="font-size: 12px;">
                                üëë Admin
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" placeholder="vas@email.cz" required>
                    </div>
                    <div class="form-group">
                        <label>Heslo</label>
                        <input type="password" id="loginPassword" placeholder="heslo" required>
                    </div>
                    <div id="loginError" style="color: #ef4444; margin-top: 10px; display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="hideLoginModal()">Zru≈°it</button>
                    <button class="btn btn-primary" onclick="handleLogin()">üîê P≈ôihl√°sit</button>
                </div>
            </div>
        </div>

        <!-- Auth Modal (prvn√≠ spu≈°tƒõn√≠) -->
        <div id="authModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üîê Autentizace za≈ô√≠zen√≠</h2>
                </div>
                <div class="modal-body">
                    <div style="margin-bottom: 20px; color: #6b7280;">
                        <p>
                            P≈ôi prvn√≠m spu≈°tƒõn√≠ mus√≠te ovƒõ≈ôit, ≈æe simul√°tor pat≈ô√≠ ke spr√°vn√©mu fyzick√©mu kurn√≠ku.
                            Pou≈æijte <strong>Device ID</strong> vybran√©ho za≈ô√≠zen√≠ a jeho <strong>Factory
                                Password</strong>.
                        </p>
                        <div
                            style="background: #f0f9ff; border-left: 4px solid #0ea5e9; border-radius: 8px; padding: 10px; color: #0369a1; font-size: 12px;">
                            <strong>Jak zjistit √∫daje?</strong>
                            <ol style="margin: 8px 0 0 18px; padding: 0;">
                                <li>Device ID = ƒç√≠slo za≈ô√≠zen√≠ z Management Console (nap≈ô. <code>#4</code>).</li>
                                <li>Factory Password = heslo v tabulce MqttDevice / detailu za≈ô√≠zen√≠ (viditeln√© pro
                                    admina).</li>
                            </ol>
                            <p style="margin: 8px 0 0;">
                                <strong>D≈Øle≈æit√©:</strong> Toto heslo zad√°van√© na fyzick√©m kurn√≠ku (nebo v simul√°toru)
                                se pou≈æije p≈ôi vol√°n√≠
                                <code>/api/mqtt/devices/auth</code>. Za≈ô√≠zen√≠ ode≈°le <em>Device ID + Factory
                                    Password</em>, aby z√≠skalo
                                aktu√°ln√≠ MQTT credentials. Pokud nen√≠ heslo vyplnƒõn√©, backend doƒçasnƒõ pou≈æije stejnou
                                hodnotu jako MQTT username,
                                co≈æ ale nedoporuƒçujeme pro produkci.
                            </p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Device ID</label>
                        <input type="text" id="authDeviceId" placeholder="123" required>
                        <small style="color: #6b7280; font-size: 12px;">ƒå√≠slo za≈ô√≠zen√≠ z Management Console (shodn√© s
                            #ID ve v√Ωbƒõru v√Ω≈°e)</small>
                    </div>

                    <div class="form-group">
                        <label>Factory Password</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="password" id="authPassword" placeholder="factory_password" required
                                style="flex: 1;">
                            <button type="button" class="btn btn-secondary btn-small"
                                onclick="fillDefaultFactoryPassword()"
                                title="Vyplnit defaultn√≠ heslo pro testov√°n√≠ (123)"
                                style="font-size: 12px; white-space: nowrap;">
                                ‚ö° Default
                            </button>
                        </div>
                        <small style="color: #6b7280; font-size: 12px;">Najdete v detailu za≈ô√≠zen√≠ / MqttDevice (admin)
                            ‚Äì je unik√°tn√≠ pro ka≈æd√Ω kurn√≠k</small>
                    </div>

                    <div id="authError" style="color: #ef4444; margin-top: 10px; display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="DeviceAuth.hideAuthModal()">Zru≈°it</button>
                    <button class="btn btn-primary" onclick="performDeviceAuth()">üîê Autentizovat</button>
                </div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="grid">
            <!-- Device Info Card -->
            <div class="card" id="deviceInfoCard" style="display: none; grid-column: 1 / -1;">
                <h2>üè† Informace o za≈ô√≠zen√≠</h2>
                <div style="display: grid; gap: 20px; margin-top: 15px;">
                    <!-- Device Details -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="padding: 12px; background: #f3f4f6; border-radius: 8px;">
                            <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Za≈ô√≠zen√≠</div>
                            <div style="font-weight: 600; color: #111827;" id="deviceInfoName">-</div>
                        </div>
                        <div style="padding: 12px; background: #f3f4f6; border-radius: 8px;">
                            <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Device ID</div>
                            <div style="font-weight: 600; color: #111827; font-family: monospace;" id="deviceInfoId">-
                            </div>
                        </div>
                        <div style="padding: 12px; background: #f3f4f6; border-radius: 8px;">
                            <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Vlastn√≠k</div>
                            <div style="font-weight: 600; color: #111827;" id="deviceInfoOwner">-</div>
                        </div>
                        <div style="padding: 12px; background: #f3f4f6; border-radius: 8px;">
                            <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Status</div>
                            <div style="font-weight: 600;" id="deviceInfoStatus">-</div>
                        </div>
                    </div>

                    <!-- Modules List -->
                    <div>
                        <div style="font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 10px;">üì¶
                            P≈ôipojen√© moduly (<span id="deviceModulesCount">0</span>)</div>
                        <div id="deviceModulesList"
                            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 15px;">
                            <!-- Detailn√≠ ovl√°dac√≠ karty modul≈Ø se napln√≠ dynamicky -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sensors Card -->
            <div class="card" id="sensorsCard">
                <h2>üå°Ô∏è Senzory</h2>

                <div id="sensorModuleStatus"
                    style="padding: 10px; background: #fef3c7; border-radius: 6px; margin-bottom: 15px; display: none;">
                    <div style="font-size: 12px; color: #92400e; text-align: center;">
                        ‚ö†Ô∏è Modul senzor≈Ø nen√≠ p≈ôipojen k tomuto za≈ô√≠zen√≠
                    </div>
                </div>

                <div id="sensorsContent">
                    <div class="sensor-item">
                        <div class="sensor-label">Teplota</div>
                        <div class="sensor-value" id="temperature">--¬∞C</div>
                        <div class="sensor-range">
                            <input type="range" id="tempRange" min="15" max="35" value="22"
                                onchange="sensors.setTemperature(this.value)">
                            <span class="range-label">15¬∞C - 35¬∞C</span>
                        </div>
                    </div>

                    <div class="sensor-item">
                        <div class="sensor-label">Vlhkost</div>
                        <div class="sensor-value" id="humidity">--%</div>
                        <div class="sensor-range">
                            <input type="range" id="humidityRange" min="30" max="90" value="65"
                                onchange="sensors.setHumidity(this.value)">
                            <span class="range-label">30% - 90%</span>
                        </div>
                    </div>

                    <div class="sensor-item">
                        <div class="sensor-label">Svƒõtlo</div>
                        <div class="sensor-value" id="light">--</div>
                        <div class="sensor-range">
                            <input type="range" id="lightRange" min="0" max="1000" value="450"
                                onchange="sensors.setLight(this.value)">
                            <span class="range-label">0 - 1000 lux</span>
                        </div>
                    </div>

                    <div class="switch-item">
                        <span>Auto-generov√°n√≠ n√°hodn√Ωch hodnot</span>
                        <label class="switch">
                            <input type="checkbox" id="autoSensors" onchange="sensors.toggleAuto(this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Door Control Card -->
            <div class="card" id="doorCard">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 style="margin: 0;">üö™ Smart Door</h2>
                    <div id="doorModuleBadge"
                        style="font-size: 11px; padding: 4px 10px; background: #10b981; color: white; border-radius: 12px; font-weight: 600;">
                        üü¢ Online
                    </div>
                </div>

                <div id="doorModuleStatus"
                    style="padding: 10px; background: #fef3c7; border-radius: 6px; margin-bottom: 15px; display: none;">
                    <div style="font-size: 12px; color: #92400e; text-align: center;">
                        ‚ö†Ô∏è Modul Smart Door nen√≠ p≈ôipojen k tomuto za≈ô√≠zen√≠
                    </div>
                </div>

                <div id="doorContent">
                    <!-- Vizualizace dve≈ô√≠ -->
                    <div class="door-visual" style="margin-bottom: 20px;">
                        <div id="doorVisual" class="door closed">
                            <div class="door-label">ZAV≈òENO</div>
                        </div>
                    </div>

                    <!-- Status info -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <div style="padding: 10px; background: #f0f9ff; border-radius: 6px; border: 1px solid #bfdbfe;">
                            <div
                                style="font-size: 10px; color: #6b7280; text-transform: uppercase; font-weight: 600; margin-bottom: 4px;">
                                Stav</div>
                            <div id="doorState" class="badge badge-secondary" style="font-size: 13px;">closed</div>
                        </div>
                        <div style="padding: 10px; background: #f0fdf4; border-radius: 6px; border: 1px solid #bbf7d0;">
                            <div
                                style="font-size: 10px; color: #6b7280; text-transform: uppercase; font-weight: 600; margin-bottom: 4px;">
                                Pozice</div>
                            <div id="doorPosition" style="font-size: 13px; color: #1f2937; font-weight: 600;">0%</div>
                        </div>
                    </div>

                    <!-- Manu√°ln√≠ ovl√°d√°n√≠ -->
                    <div
                        style="background: #f9fafb; padding: 15px; border-radius: 10px; border: 1px solid #e5e7eb; margin-bottom: 15px;">
                        <div
                            style="font-size: 12px; color: #6b7280; font-weight: 600; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">
                            üéÆ Manu√°ln√≠ ovl√°d√°n√≠</div>
                        <div class="button-group" id="doorButtons">
                            <button class="btn btn-success" onclick="door.open()" id="doorOpenBtn">‚¨ÜÔ∏è Otev≈ô√≠t</button>
                            <button class="btn btn-danger" onclick="door.close()" id="doorCloseBtn">‚¨áÔ∏è Zav≈ô√≠t</button>
                            <button class="btn btn-warning" onclick="door.stop()" id="doorStopBtn">‚è∏Ô∏è Stop</button>
                        </div>
                    </div>

                    <!-- Automatick√© nastaven√≠ -->
                    <div
                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px; border-radius: 10px; margin-bottom: 15px; color: white;">
                        <div style="font-size: 13px; font-weight: 600; margin-bottom: 12px;">‚öôÔ∏è Automatick√© ovl√°d√°n√≠
                        </div>

                        <!-- Zapnuto/Vypnuto -->
                        <div class="switch-item"
                            style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 6px; margin-bottom: 12px;">
                            <span style="font-size: 12px; font-weight: 500; color: white;">Automatika zapnuta</span>
                            <label class="switch">
                                <input type="checkbox" id="doorEnabled" checked
                                    onchange="door.enabled = this.checked; door.saveSettings(); door.calculateNextAction();">
                                <span class="slider"></span>
                            </label>
                        </div>

                        <!-- Re≈æim -->
                        <div style="margin-bottom: 12px;">
                            <label
                                style="display: block; font-size: 11px; color: rgba(255,255,255,0.9); margin-bottom: 6px; font-weight: 600; text-transform: uppercase;">Re≈æim</label>
                            <select id="doorMode"
                                onchange="door.mode = this.value; door.saveSettings(); door.calculateNextAction();"
                                style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.15); color: white; font-size: 13px;">
                                <option value="sun" style="background: #667eea; color: white;">‚òÄÔ∏è Podle slunce</option>
                                <option value="timer" style="background: #667eea; color: white;">‚è∞ Pevn√Ω ƒças</option>
                            </select>
                        </div>

                        <!-- ƒåasy (timer re≈æim) -->
                        <div id="doorTimerSettings" style="display: none;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                                <div>
                                    <label
                                        style="display: block; font-size: 11px; color: rgba(255,255,255,0.9); margin-bottom: 6px;">ƒåas
                                        otev≈ôen√≠</label>
                                    <input type="time" id="doorOpenTime" value="06:00"
                                        onchange="door.openTime = this.value; door.saveSettings(); door.calculateNextAction();"
                                        style="width: 100%; padding: 8px; border-radius: 6px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; font-size: 13px;">
                                </div>
                                <div>
                                    <label
                                        style="display: block; font-size: 11px; color: rgba(255,255,255,0.9); margin-bottom: 6px;">ƒåas
                                        zav≈ôen√≠</label>
                                    <input type="time" id="doorCloseTime" value="21:00"
                                        onchange="door.closeTime = this.value; door.saveSettings(); door.calculateNextAction();"
                                        style="width: 100%; padding: 8px; border-radius: 6px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; font-size: 13px;">
                                </div>
                            </div>
                        </div>

                        <!-- Offset (sun re≈æim) -->
                        <div id="doorSunSettings">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                                <div>
                                    <label
                                        style="display: block; font-size: 11px; color: rgba(255,255,255,0.9); margin-bottom: 6px;">Offset
                                        otev≈ôen√≠ (min)</label>
                                    <input type="number" id="doorOpenOffset" value="0" min="-120" max="120"
                                        onchange="door.openOffset = parseInt(this.value); door.saveSettings(); door.calculateNextAction();"
                                        style="width: 100%; padding: 8px; border-radius: 6px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; font-size: 13px;">
                                </div>
                                <div>
                                    <label
                                        style="display: block; font-size: 11px; color: rgba(255,255,255,0.9); margin-bottom: 6px;">Offset
                                        zav≈ôen√≠ (min)</label>
                                    <input type="number" id="doorCloseOffset" value="0" min="-120" max="120"
                                        onchange="door.closeOffset = parseInt(this.value); door.saveSettings(); door.calculateNextAction();"
                                        style="width: 100%; padding: 8px; border-radius: 6px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; font-size: 13px;">
                                </div>
                            </div>
                        </div>

                        <!-- Tlaƒç√≠tko naƒç√≠st ƒçasy -->
                        <button class="btn btn-primary" onclick="door.loadSunTimesFromApi(chickens.currentCoopId)"
                            id="doorLoadSunTimesBtn"
                            style="width: 100%; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; font-weight: 600; padding: 10px;">
                            üåÖ Naƒç√≠st ƒçasy slunce z API
                        </button>
                    </div>

                    <!-- Pl√°n -->
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 10px; border: 1px solid #bfdbfe;">
                        <div
                            style="font-size: 12px; color: #0369a1; font-weight: 600; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">
                            üìÖ Pl√°n</div>

                        <div style="margin-bottom: 8px;">
                            <div style="font-size: 11px; color: #6b7280; margin-bottom: 4px;">Re≈æim:</div>
                            <div id="doorScheduleDisplay" style="font-size: 13px; color: #1f2937; font-weight: 600;">‚òÄÔ∏è
                                Re≈æim podle slunce</div>
                        </div>

                        <div>
                            <div style="font-size: 11px; color: #6b7280; margin-bottom: 4px;">Dal≈°√≠ akce:</div>
                            <div id="doorNextAction" style="font-size: 13px; color: #0369a1; font-weight: 600;">-</div>
                        </div>
                    </div>

                    <!-- Legacy auto mode switch -->
                    <div class="switch-item" style="margin-top: 15px; display: none;">
                        <span>Auto re≈æim (Legacy)</span>
                        <label class="switch">
                            <input type="checkbox" id="doorAutoMode" onchange="door.setAutoMode(this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Feeder Card -->
            <div class="card" id="feederCard">
                <div class="feeder-card-header">
                    <div>
                        <h2 style="margin: 0;">üçΩÔ∏è Feeder</h2>
                        <div class="feeder-module-meta">
                            <span id="feederModuleName">Simulovan√© krm√≠tko</span>
                            <span id="feederModuleId">ID: -</span>
                        </div>
                    </div>
                    <div id="feederStatusBadge" class="feeder-status-badge offline">‚ö´ Odpojeno</div>
                </div>

                <div id="feederModuleStatus"
                    style="padding: 12px; background: #fef3c7; border-radius: 8px; border: 1px solid #fde68a; margin-bottom: 15px; display: none;">
                    <div style="font-size: 13px; color: #92400e; font-weight: 600; margin-bottom: 4px;">‚ö†Ô∏è Modul krm√≠tka
                        nen√≠ p≈ôipojen</div>
                    <div style="font-size: 12px; color: #78350f;">P≈ôipojte modul typu <strong>feeder</strong> v
                        Management Console, aby bylo mo≈æn√© simulovat krm√≠tko p≈ôes toto za≈ô√≠zen√≠.</div>
                </div>

                <div id="feederContent">
                    <div class="feeder-tabs" id="feederTabButtons">
                        <button type="button" class="active" data-tab="overview">üìä P≈ôehled</button>
                        <button type="button" data-tab="schedule">‚è∞ Rozvrh</button>
                        <button type="button" data-tab="manual">üéÆ Manu√°ln√≠</button>
                    </div>

                    <!-- Overview -->
                    <div class="feeder-tab-panel" data-tab="overview">
                        <div class="feeder-stats-grid">
                            <div class="feeder-stat-card">
                                <div class="label">√örove≈à krmiva</div>
                                <div class="value" id="feederFoodLevelValue">75%</div>
                                <div class="sub">zb√Ωv√°</div>
                            </div>
                            <div class="feeder-stat-card">
                                <div class="label">Posledn√≠ krmen√≠</div>
                                <div class="value" id="feederLastFeedValue">‚Äì</div>
                                <div class="sub">ƒças</div>
                            </div>
                            <div class="feeder-stat-card">
                                <div class="label">Dnes vyd√°no</div>
                                <div class="value" id="feederDailyTotalValue">0 g</div>
                                <div class="sub">souƒçet</div>
                            </div>
                            <div class="feeder-stat-card">
                                <div class="label">Aktivn√≠ rozvrhy</div>
                                <div class="value" id="feederActiveSchedulesValue">3</div>
                                <div class="sub">napl√°nov√°no</div>
                            </div>
                        </div>

                        <div class="feeder-progress-card">
                            <div class="progress-header">
                                <span>Z√°sobn√≠k</span>
                                <span id="feederFoodLevelPercent">75%</span>
                            </div>
                            <div class="feeder-progress-bar">
                                <div id="feederProgressFill" style="width: 75%;"></div>
                            </div>
                            <div class="feeder-adjust">
                                <label for="feederLevelRange">Simulovan√° hladina</label>
                                <input type="range" id="feederLevelRange" min="0" max="100" value="75">
                                <small>T√°hnut√≠m nastav√≠te vlastn√≠ hodnotu z√°sobn√≠ku.</small>
                            </div>
                            <button class="btn btn-secondary btn-small" id="feederRefillBtn"
                                style="margin-top: 10px; width: 100%;">üîÑ Doplnit na 100%</button>
                        </div>

                        <div class="feeder-quick-actions" id="feederActions">
                            <button class="btn btn-primary" id="feederQuickFeedBtn">
                                ‚ñ∂Ô∏è Nakrmit 25 g
                            </button>
                            <button class="btn btn-secondary" id="feederScheduleShortcut">
                                üóìÔ∏è Upravit rozvrh
                            </button>
                        </div>

                        <div class="feeder-communication">
                            <div>
                                <div class="label">Posledn√≠ synchronizace</div>
                                <div id="feederLastSync">‚Äì</div>
                            </div>
                            <div>
                                <div class="label">Posledn√≠ aktualizace za≈ô√≠zen√≠</div>
                                <div id="feederLastUpdate">‚Äì</div>
                            </div>
                        </div>
                    </div>

                    <!-- Schedule -->
                    <div class="feeder-tab-panel" data-tab="schedule" style="display: none;">
                        <div class="feeder-schedule-header">
                            <div>
                                <h3>‚è∞ Rozvrh krmen√≠</h3>
                                <p>Spravujte jednotliv√© d√°vky bƒõhem dne.</p>
                            </div>
                            <button class="btn btn-secondary btn-small" id="feederAddScheduleBtn">‚ûï P≈ôidat</button>
                        </div>

                        <div id="feederScheduleList" class="feeder-schedule-list">
                            <!-- Items generated dynamicky -->
                        </div>
                        <div id="feederScheduleEmpty" class="feeder-schedule-empty" style="display: none;">
                            <p>≈Ω√°dn√© napl√°novan√© d√°vky.</p>
                            <small>P≈ôidejte prvn√≠ ƒças pomoc√≠ tlaƒç√≠tka ‚Äû‚ûï P≈ôidat‚Äú.</small>
                        </div>

                        <div class="feeder-save-row">
                            <button class="btn btn-primary" id="feederSaveScheduleBtn">üíæ Ulo≈æit rozvrh</button>
                        </div>
                    </div>

                    <!-- Manual -->
                    <div class="feeder-tab-panel" data-tab="manual" style="display: none;">
                        <div class="feeder-manual-card">
                            <h3>üéÆ Manu√°ln√≠ krmen√≠</h3>
                            <label for="feederManualInput">Mno≈æstv√≠ krmiva (g)</label>
                            <div class="feeder-manual-input">
                                <input type="number" id="feederManualInput" value="25" min="1" max="120">
                                <span>gram≈Ø</span>
                            </div>

                            <div class="feeder-preset-buttons" id="feederPresetButtons">
                                <button type="button" data-amount="10">10 g</button>
                                <button type="button" data-amount="25" class="active">25 g</button>
                                <button type="button" data-amount="50">50 g</button>
                                <button type="button" data-amount="75">75 g</button>
                            </div>

                            <div class="button-group" id="feederManualButtons">
                                <button class="btn btn-primary" id="feederManualFeedBtn" style="flex: 1;">‚ñ∂Ô∏è Vydat
                                    krmivo</button>
                                <button class="btn btn-warning" id="feederSimulateJamBtn" style="flex: 1;">‚ö†Ô∏è Simulovat
                                    z√°sek</button>
                            </div>

                            <div class="feeder-manual-info">
                                <div>Posledn√≠ akce:</div>
                                <div id="feederManualInfo">≈Ω√°dn√°</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Camera Card -->
            <div class="card camera-card" id="cameraCard">
                <div class="camera-card-header">
                    <div>
                        <h2 style="margin: 0;">üìπ Kamera</h2>
                        <div class="camera-meta">
                            <span id="cameraModuleName">Simulovan√° kamera</span>
                            <span id="cameraModuleId">ID: -</span>
                        </div>
                    </div>
                    <div id="cameraStatusBadge" class="camera-status-badge offline">üî¥ Offline</div>
                </div>

                <div id="cameraModuleStatus" class="camera-warning" style="display: none;">
                    <div class="camera-warning-title">‚ö†Ô∏è Modul kamery nen√≠ p≈ôipojen</div>
                    <div class="camera-warning-text">
                        Pro p≈ô√≠stup ke kame≈ôe p≈ôidejte modul typu <strong>camera</strong> v Management Console a
                        p≈ôipojte jej k tomuto za≈ô√≠zen√≠.
                    </div>
                </div>

                <div id="cameraContent">
                    <div class="camera-panels">
                        <div class="camera-panel" id="cameraStatusPanel">
                            <div class="camera-panel-header">
                                <span>Stav kamery</span>
                                <div class="camera-dot" id="cameraStatusDot"></div>
                            </div>
                            <div class="camera-status-info">
                                <div class="camera-status-title" id="cameraStatusText">Offline</div>
                                <div class="camera-status-subtext" id="cameraStatusSubtext">ƒåek√°m na p≈ôipojen√≠...</div>
                            </div>
                        </div>

                        <div class="camera-panel stream-panel">
                            <div class="camera-panel-header">
                                <span>≈Ωiv√Ω p≈ôenos</span>
                            </div>
                            <div class="camera-stream" id="cameraStream">
                                <div class="camera-stream-placeholder" id="cameraStreamPlaceholder">
                                    <div class="camera-stream-icon" id="cameraStreamIcon">üì°</div>
                                    <div class="camera-stream-text" id="cameraStreamText">Stream bude zobrazen zde</div>
                                    <div class="camera-stream-subtext" id="cameraStreamSubtext">Kamera nen√≠ p≈ôipojena
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="camera-panel controls-panel">
                        <div class="camera-panel-header">
                            <span>Ovl√°d√°n√≠</span>
                        </div>
                        <div class="camera-controls" id="cameraControls">
                            <button class="btn btn-primary" id="cameraTakePhotoBtn">üì∏ Vyfotit</button>
                            <button class="btn btn-secondary" id="cameraFetchLatestBtn">‚¨áÔ∏è St√°hnout posledn√≠
                                fotku</button>
                            <button class="btn btn-success" id="cameraRecordBtn">‚è∫Ô∏è Nahr√°t</button>
                            <button class="btn btn-danger" id="cameraStopBtn" style="display: none;">‚èπÔ∏è
                                Zastavit</button>
                        </div>
                        <div class="camera-recording-indicator" id="cameraRecordingIndicator" style="display: none;">
                            <div class="camera-recording-dot"></div>
                            <div class="camera-recording-text">Nahr√°v√°n√≠ prob√≠h√°...</div>
                        </div>
                    </div>

                    <div class="camera-panel snapshots-panel">
                        <div class="camera-panel-header">
                            <span>Posledn√≠ sn√≠mky</span>
                            <span id="cameraSnapshotCount">0 sn√≠mk≈Ø</span>
                        </div>
                        <div class="camera-filter-buttons" id="cameraFilterButtons">
                            <button data-filter="all" class="active">V≈°e</button>
                            <button data-filter="today">Dnes</button>
                            <button data-filter="yesterday">Vƒçera</button>
                            <button data-filter="week">T√Ωden</button>
                        </div>
                        <div class="camera-snapshots" id="cameraSnapshotsContainer"></div>
                        <div class="camera-snapshots-empty" id="cameraSnapshotsEmpty" style="display: none;">
                            <div>üì∑</div>
                            <p>Zat√≠m ≈æ√°dn√© sn√≠mky</p>
                        </div>
                    </div>

                    <div class="camera-panel diagnostics-panel">
                        <div class="camera-panel-header">
                            <span>Diagnostika</span>
                        </div>
                        <div class="camera-diagnostics">
                            <div class="camera-diagnostic-row">
                                <div class="camera-diagnostic-icon">üì°</div>
                                <div>
                                    <div class="camera-diagnostic-label">P≈ôipojen√≠</div>
                                    <div class="camera-diagnostic-value" id="cameraDiagConnection">Neaktivn√≠</div>
                                </div>
                            </div>
                            <div class="camera-diagnostic-row">
                                <div class="camera-diagnostic-icon">üîó</div>
                                <div>
                                    <div class="camera-diagnostic-label">Stream URL</div>
                                    <div class="camera-diagnostic-value" id="cameraDiagStream">Nezad√°no</div>
                                </div>
                            </div>
                            <div class="camera-diagnostic-row">
                                <div class="camera-diagnostic-icon">‚è∫Ô∏è</div>
                                <div>
                                    <div class="camera-diagnostic-label">Nahr√°v√°n√≠</div>
                                    <div class="camera-diagnostic-value" id="cameraDiagRecording">Neaktivn√≠</div>
                                </div>
                            </div>
                            <div class="camera-diagnostic-row">
                                <div class="camera-diagnostic-icon">üñºÔ∏è</div>
                                <div>
                                    <div class="camera-diagnostic-label">Sn√≠mky</div>
                                    <div class="camera-diagnostic-value" id="cameraDiagSnapshots">0 sn√≠mk≈Ø</div>
                                </div>
                            </div>
                        </div>
                        style="text-align: center; border-left: 1px solid rgba(255,255,255,0.2); border-right: 1px solid
                        rgba(255,255,255,0.2);">
                        <div style="font-size: 36px; font-weight: bold; color: white; line-height: 1; margin-bottom: 6px;"
                            id="chickensOutside">0</div>
                        <div
                            style="font-size: 11px; color: rgba(255,255,255,0.9); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                            üå≥ Venku</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 36px; font-weight: bold; color: white; line-height: 1; margin-bottom: 6px;"
                            id="chickensTotal">0</div>
                        <div
                            style="font-size: 11px; color: rgba(255,255,255,0.9); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                            üêî Celkem</div>
                    </div>
                </div>
            </div>

            <!-- Seznam slepic -->
            <div id="chickensListContainer" style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h3 style="font-size: 14px; margin: 0; color: #1f2937; font-weight: 600;">üìã Seznam slepic
                    </h3>
                </div>
                <div id="chickensList"
                    style="display: flex; flex-direction: column; gap: 8px; max-height: 400px; overflow-y: auto; padding-right: 5px;">
                    <!-- Seznam slepic se napln√≠ dynamicky -->
                </div>
            </div>

            <!-- P≈ôid√°n√≠ nov√© slepice -->
            <div id="addChickenContainer"
                style="display: none; margin-bottom: 15px; padding: 16px; background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%); border-radius: 10px; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h3 style="font-size: 15px; margin: 0; color: #065f46; font-weight: 700;">‚ú® P≈ôidat novou
                        slepici
                    </h3>
                    <button class="btn btn-danger btn-small" onclick="chickens.cancelAddChicken()"
                        style="padding: 6px 12px;">‚ùå</button>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <label
                        style="display: block; font-size: 12px; color: #374151; margin-bottom: 6px; font-weight: 600;">Jm√©no
                        slepice:</label>
                    <input type="text" id="newChickenName" placeholder="Nap≈ô. Bƒõtu≈°ka"
                        style="width: 100%; padding: 10px; border: 2px solid #10b981; border-radius: 6px; margin-bottom: 12px; font-size: 14px;">

                    <label
                        style="display: block; font-size: 12px; color: #374151; margin-bottom: 6px; font-weight: 600;">RFID
                        Tag:</label>
                    <div style="display: grid; grid-template-columns: 1fr auto auto; gap: 8px;">
                        <input type="text" id="newChickenTag" placeholder="RFID tag"
                            style="padding: 10px; border: 2px solid #10b981; border-radius: 6px; font-size: 13px; font-family: monospace;">
                        <button class="btn btn-primary btn-small" onclick="chickens.generateRandomTagForNewChicken()"
                            title="Vygenerovat n√°hodn√Ω tag">üé≤</button>
                        <button class="btn btn-warning btn-small" onclick="chickens.scanRfidForNewChicken()"
                            title="Simulovat sken">üì°</button>
                    </div>
                </div>
                <button class="btn btn-success" onclick="chickens.confirmAddChicken()"
                    style="width: 100%; padding: 12px; font-weight: 600; font-size: 14px;">
                    ‚úÖ P≈ôidat slepici
                </button>
            </div>

            <!-- Akce a spr√°va -->
            <div style="background: #f9fafb; padding: 15px; border-radius: 10px; border: 1px solid #e5e7eb;">
                <!-- Tlaƒç√≠tka pro spr√°vu slepic -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                    <button class="btn btn-success" onclick="chickens.showAddChickenForm()" id="addChickenBtn"
                        style="font-weight: 600; padding: 10px;">
                        ‚ûï P≈ôidat slepici
                    </button>
                    <button class="btn btn-primary" onclick="chickens.syncWithServer()" id="syncChickensBtn"
                        style="font-weight: 600; padding: 10px;">
                        üîÑ Synchronizovat
                    </button>
                </div>

                <!-- RFID simulace -->
                <div style="border-top: 1px solid #e5e7eb; padding-top: 12px;">
                    <div
                        style="font-size: 12px; color: #6b7280; font-weight: 600; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">
                        ‚ö° RFID Simulace</div>
                    <div class="button-group" style="margin-bottom: 10px;">
                        <button class="btn btn-primary" onclick="chickens.enter()" style="flex: 1;">‚û°Ô∏è
                            Vstup</button>
                        <button class="btn btn-secondary" onclick="chickens.exit()" style="flex: 1;">‚¨ÖÔ∏è
                            V√Ωstup</button>
                    </div>

                    <div class="switch-item"
                        style="background: white; padding: 10px; border-radius: 6px; border: 1px solid #e5e7eb;">
                        <span style="font-size: 12px; font-weight: 500;">Auto re≈æim (n√°hodn√© ud√°losti)</span>
                        <label class="switch">
                            <input type="checkbox" id="autoRfid" onchange="chickens.toggleAuto(this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Smart Counter Card -->
        <div class="card" id="smartCounterCard">
            <h2>ü•ö Smart Counter</h2>

            <div
                style="padding: 12px; background: #fef2f2; border-left: 4px solid #ef4444; border-radius: 6px; margin-bottom: 15px;">
                <div style="font-size: 13px; color: #991b1b; margin-bottom: 6px;">
                    <strong>‚ÑπÔ∏è Poƒç√≠t√°n√≠ vajec:</strong>
                </div>
                <div style="font-size: 12px; color: #991b1b; line-height: 1.6;">
                    Kliknƒõte na kartu slepice pro zaznamen√°n√≠ sn√°≈°ky vejce. Ka≈æd√° slepice m√° vlastn√≠ denn√≠
                    poƒç√≠tadlo.
                </div>
            </div>

            <div id="smartCounterNoChickens"
                style="padding: 20px; background: #fef3c7; border-radius: 8px; text-align: center; color: #92400e; font-size: 13px;">
                ‚ö†Ô∏è ≈Ω√°dn√© slepice v za≈ô√≠zen√≠<br>
                <small style="font-size: 11px;">P≈ôidejte slepici v sekci "üì° RFID br√°na"</small>
            </div>

            <!-- Grid karet slepic -->
            <div id="smartCounterChickensGrid"
                style="display: none; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
                <!-- Karty slepic se napln√≠ dynamicky -->
            </div>
        </div>

        <!-- Network Card - Enhanced with AP Mode, WiFi Client, GSM -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;">üì° S√≠≈•</h2>
                <div id="networkMode" class="badge badge-info">üîì AP Mode</div>
            </div>

            <!-- Network Mode Selector -->
            <div
                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px; border-radius: 10px; margin-bottom: 15px; color: white;">
                <div style="font-size: 13px; font-weight: 600; margin-bottom: 10px;">‚öôÔ∏è S√≠≈•ov√Ω re≈æim</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                    <button class="btn btn-secondary btn-small" onclick="network.switchToApMode()"
                        style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white;">
                        üîì AP Mode
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="network.switchToWifiClient()"
                        style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white;">
                        üì∂ WiFi Client
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="network.switchToGsm()"
                        style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white;">
                        üì° GSM
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="network.goOffline()"
                        style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white;">
                        üì¥ Offline
                    </button>
                </div>
            </div>

            <!-- WiFi Section -->
            <div
                style="background: #f0f9ff; padding: 15px; border-radius: 10px; border: 1px solid #bfdbfe; margin-bottom: 15px;">
                <div
                    style="font-size: 12px; color: #0369a1; font-weight: 600; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">
                    üì∂ WiFi</div>

                <div class="status-item">
                    <span>Status:</span>
                    <span id="wifiStatus" class="badge badge-success">Connected</span>
                </div>
                <div class="status-item">
                    <span>SSID:</span>
                    <span id="wifiSsid" style="font-family: monospace; font-size: 12px;">Not configured</span>
                </div>
                <div class="status-item">
                    <span>Signal:</span>
                    <span id="wifiSignal">-45 dBm</span>
                </div>

                <!-- WiFi Configuration (shown when configuring) -->
                <div id="wifiConfigSection"
                    style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #bfdbfe; display: none;">
                    <label
                        style="display: block; font-size: 11px; color: #6b7280; margin-bottom: 4px; font-weight: 600;">WiFi
                        SSID:</label>
                    <input type="text" id="wifiConfigSsid" placeholder="MyNetwork"
                        style="width: 100%; padding: 8px; border: 1px solid #bfdbfe; border-radius: 6px; margin-bottom: 8px; font-size: 13px;">

                    <label
                        style="display: block; font-size: 11px; color: #6b7280; margin-bottom: 4px; font-weight: 600;">Password:</label>
                    <input type="password" id="wifiConfigPassword" placeholder="********"
                        style="width: 100%; padding: 8px; border: 1px solid #bfdbfe; border-radius: 6px; margin-bottom: 8px; font-size: 13px;">

                    <button class="btn btn-primary btn-small" onclick="configureWifiFromUI()"
                        style="width: 100%; padding: 8px; font-size: 12px;">
                        ‚úÖ Ulo≈æit a p≈ôipojit
                    </button>
                </div>

                <button class="btn btn-secondary btn-small" onclick="toggleWifiConfig()" id="wifiConfigBtn"
                    style="width: 100%; margin-top: 10px; font-size: 12px;">
                    ‚öôÔ∏è Konfigurovat WiFi
                </button>

                <!-- WiFi Scanner -->
                <button class="btn btn-primary btn-small" onclick="network.scanWifiNetworks()" id="wifiScanBtn"
                    style="width: 100%; margin-top: 8px; font-size: 12px;">
                    üîç Hledat s√≠tƒõ
                </button>

                <!-- WiFi Scan Results (hidden by default) -->
                <div id="wifiScanResults"
                    style="margin-top: 10px; background: white; border: 1px solid #bfdbfe; border-radius: 6px; display: none;">
                </div>
            </div>

            <!-- GSM Section -->
            <div
                style="background: #fef3c7; padding: 15px; border-radius: 10px; border: 1px solid #fde68a; margin-bottom: 15px;">
                <div
                    style="font-size: 12px; color: #92400e; font-weight: 600; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">
                    üì° GSM Module</div>

                <div class="status-item">
                    <span>Status:</span>
                    <span id="gsmStatus" class="badge badge-warning">Disabled</span>
                </div>
                <div class="status-item">
                    <span>Oper√°tor:</span>
                    <span id="gsmOperator" style="font-size: 12px;">N/A</span>
                </div>
                <div class="status-item">
                    <span>Signal:</span>
                    <span id="gsmSignal">--</span>
                </div>
                <div class="status-item">
                    <span>Data:</span>
                    <span id="gsmDataUsage" style="font-size: 11px; font-family: monospace;">0.0 / 1000
                        MB</span>
                </div>

                <div
                    style="margin-top: 10px; padding: 8px; background: rgba(146, 64, 14, 0.1); border-radius: 6px; font-size: 11px; color: #92400e;">
                    ‚ÑπÔ∏è <strong>Periodic Mode:</strong> GSM odes√≠l√° heartbeat ka≈æd√Ωch 5 minut (ne continuous)
                </div>

                <!-- GSM Configuration Section -->
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #fde68a;">
                    <div style="font-size: 11px; color: #92400e; font-weight: 600; margin-bottom: 8px;">‚öôÔ∏è GSM
                        Konfigurace:</div>

                    <div style="margin-bottom: 8px;">
                        <label
                            style="display: block; font-size: 10px; color: #78350f; margin-bottom: 4px; font-weight: 600;">APN:</label>
                        <input type="text" id="gsmConfigApn" placeholder="internet" value="internet"
                            style="width: 100%; padding: 6px; border: 1px solid #fde68a; border-radius: 4px; font-size: 12px;">
                    </div>

                    <div style="margin-bottom: 8px;">
                        <label
                            style="display: block; font-size: 10px; color: #78350f; margin-bottom: 4px; font-weight: 600;">Telefonn√≠
                            ƒç√≠slo:</label>
                        <input type="text" id="gsmConfigPhone" placeholder="+420123456789" value="+420123456789"
                            style="width: 100%; padding: 6px; border: 1px solid #fde68a; border-radius: 4px; font-size: 12px;">
                    </div>

                    <button class="btn btn-secondary btn-small" onclick="configureGsmFromUI()"
                        style="width: 100%; font-size: 11px; padding: 6px;">
                        ‚úÖ Ulo≈æit GSM config
                    </button>
                </div>

                <!-- GSM Functions -->
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #fde68a;">
                    <div style="font-size: 11px; color: #92400e; font-weight: 600; margin-bottom: 8px;">üõ†Ô∏è GSM
                        Funkce:</div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 8px;">
                        <button class="btn btn-secondary btn-small" onclick="network.testGsmSignal()"
                            id="gsmSignalTestBtn" style="font-size: 11px; padding: 6px;">
                            üìä Test sign√°lu
                        </button>
                        <button class="btn btn-secondary btn-small" onclick="network.checkGsmCredit()"
                            id="gsmCreditCheckBtn" style="font-size: 11px; padding: 6px;">
                            üí≥ Kontrola kreditu
                        </button>
                    </div>

                    <!-- Signal Test Results -->
                    <div id="gsmSignalTestResults" style="display: none;"></div>

                    <!-- Credit Check Results -->
                    <div id="gsmCreditDetails" style="display: none;"></div>
                </div>

                <!-- SMS Section -->
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #fde68a;">
                    <div style="font-size: 11px; color: #92400e; font-weight: 600; margin-bottom: 8px;">üì± SMS:
                    </div>

                    <div style="margin-bottom: 6px;">
                        <label
                            style="display: block; font-size: 10px; color: #78350f; margin-bottom: 4px; font-weight: 600;">P≈ô√≠jemce:</label>
                        <input type="text" id="gsmSmsRecipient" placeholder="+420777888999"
                            style="width: 100%; padding: 6px; border: 1px solid #fde68a; border-radius: 4px; font-size: 12px;">
                    </div>

                    <div style="margin-bottom: 8px;">
                        <label
                            style="display: block; font-size: 10px; color: #78350f; margin-bottom: 4px; font-weight: 600;">Zpr√°va:</label>
                        <textarea id="gsmSmsMessage" placeholder="Test SMS ze SmartCoop..."
                            style="width: 100%; padding: 6px; border: 1px solid #fde68a; border-radius: 4px; font-size: 12px; resize: vertical; min-height: 50px;"></textarea>
                    </div>

                    <button class="btn btn-primary btn-small" onclick="sendSmsFromUI()" id="gsmSendSmsBtn"
                        style="width: 100%; font-size: 11px; padding: 6px;">
                        üì§ Odeslat SMS
                    </button>

                    <!-- SMS History -->
                    <div id="gsmSmsHistory"
                        style="margin-top: 10px; background: white; border: 1px solid #fde68a; border-radius: 6px; padding: 8px;">
                        <div style="text-align: center; padding: 10px; color: #9ca3af; font-size: 12px;">≈Ω√°dn√©
                            odeslan√© SMS</div>
                    </div>
                </div>
            </div>

            <!-- Config Hash (WiFi Direct Sync Detection) -->
            <div style="background: #f9fafb; padding: 12px; border-radius: 8px; border: 1px solid #e5e7eb;">
                <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 6px;">üîê Config
                    Hash:
                </div>
                <div id="networkConfigHash"
                    style="font-family: monospace; font-size: 11px; color: #1f2937; word-break: break-all;">
                    Calculating...</div>
                <small style="font-size: 10px; color: #9ca3af; display: block; margin-top: 4px;">
                    Pro detekci zmƒõn p≈ôes WiFi Direct / AP Mode
                </small>
            </div>
        </div>

        <!-- System Card -->
        <div class="card">
            <h2>‚öôÔ∏è Syst√©m</h2>

            <div class="status-item">
                <span>Uptime:</span>
                <span id="uptime">0s</span>
            </div>
            <div class="status-item">
                <span>Free RAM:</span>
                <span id="freeRam">234KB</span>
            </div>
            <div class="status-item">
                <span>Firmware:</span>
                <span>v1.2.5</span>
            </div>
            <div class="status-item">
                <span>Nap√°jen√≠:</span>
                <span id="powerSource" class="badge badge-success">AC Power</span>
            </div>

            <div class="button-group" style="margin-top: 15px;">
                <button class="btn btn-primary" onclick="system.sendHeartbeat()">üíì Heartbeat</button>
                <button class="btn btn-warning" onclick="system.restart()">üîÑ Restart</button>
            </div>

            <div class="switch-item">
                <span>Auto Heartbeat (10s)</span>
                <label class="switch">
                    <input type="checkbox" id="autoHeartbeat" onchange="system.toggleHeartbeat(this.checked)">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- Hardware Status Card -->
        <div class="card" id="hardwareStatusCard">
            <h2>üîß Hardware Status</h2>
            <p style="font-size: 12px; color: #6b7280; margin-bottom: 15px;">
                Stav fyzick√Ωch komponent p≈ôipojen√Ωch kabelem k ESP32
            </p>

            <!-- RTC DS3231 -->
            <div class="hardware-component"
                style="padding: 12px; background: #f0fdf4; border-radius: 8px; border: 1px solid #bbf7d0; margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <div style="font-weight: 600; color: #065f46; display: flex; align-items: center; gap: 6px;">
                        <span>üïê</span> RTC DS3231
                    </div>
                    <div id="rtcStatusBadge" class="badge badge-success">OK</div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
                    <div>
                        <span style="color: #6b7280;">ƒåas:</span>
                        <span id="rtcTime" style="font-family: monospace; color: #1f2937;">--:--:--</span>
                    </div>
                    <div>
                        <span style="color: #6b7280;">Drift:</span>
                        <span id="rtcDrift" style="color: #1f2937;">0s</span>
                    </div>
                </div>
                <div class="switch-item" style="margin-top: 8px; background: white; padding: 6px; border-radius: 4px;">
                    <span style="font-size: 11px;">Simulovat chybu RTC</span>
                    <label class="switch">
                        <input type="checkbox" id="rtcError" onchange="hardware.setRtcError(this.checked)">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <!-- SD Card -->
            <div class="hardware-component"
                style="padding: 12px; background: #f0f9ff; border-radius: 8px; border: 1px solid #bfdbfe; margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <div style="font-weight: 600; color: #0369a1; display: flex; align-items: center; gap: 6px;">
                        <span>üíæ</span> SD Karta
                    </div>
                    <div id="sdCardStatusBadge" class="badge badge-success">P≈ôipojena</div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
                    <div>
                        <span style="color: #6b7280;">Kapacita:</span>
                        <span id="sdCardCapacity" style="color: #1f2937;">32 GB</span>
                    </div>
                    <div>
                        <span style="color: #6b7280;">Voln√©:</span>
                        <span id="sdCardFree" style="color: #1f2937;">28.5 GB</span>
                    </div>
                </div>
                <div class="switch-item" style="margin-top: 8px; background: white; padding: 6px; border-radius: 4px;">
                    <span style="font-size: 11px;">Simulovat odpojen√≠ SD</span>
                    <label class="switch">
                        <input type="checkbox" id="sdCardError" onchange="hardware.setSdCardError(this.checked)">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <!-- RFID Readers (Cable Connected) -->
            <div class="hardware-component"
                style="padding: 12px; background: #fef3c7; border-radius: 8px; border: 1px solid #fde68a; margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <div style="font-weight: 600; color: #92400e; display: flex; align-items: center; gap: 6px;">
                        <span>üì°</span> RFID Readers (Wiegand)
                    </div>
                    <div id="rfidReadersStatusBadge" class="badge badge-success">4/4</div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 11px;">
                    <div
                        style="padding: 6px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>RFID IN:</span>
                        <span id="rfidInStatus" class="badge badge-success" style="font-size: 10px;">OK</span>
                    </div>
                    <div
                        style="padding: 6px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>RFID OUT:</span>
                        <span id="rfidOutStatus" class="badge badge-success" style="font-size: 10px;">OK</span>
                    </div>
                    <div
                        style="padding: 6px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>NEST 1:</span>
                        <span id="rfidNest1Status" class="badge badge-success" style="font-size: 10px;">OK</span>
                    </div>
                    <div
                        style="padding: 6px; background: white; border-radius: 4px; display: flex; justify-content: space-between;">
                        <span>NEST 2:</span>
                        <span id="rfidNest2Status" class="badge badge-success" style="font-size: 10px;">OK</span>
                    </div>
                </div>
                <div style="font-size: 10px; color: #92400e; margin-top: 6px; font-style: italic;">
                    P≈ôipojeno kabelem (GPIO piny, Wiegand 26-bit protokol)
                </div>
            </div>

            <!-- Egg Buttons (Nest Sensors) -->
            <div class="hardware-component"
                style="padding: 12px; background: #fef2f2; border-radius: 8px; border: 1px solid #fecaca; margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <div style="font-weight: 600; color: #991b1b; display: flex; align-items: center; gap: 6px;">
                        <span>ü•ö</span> Egg Buttons
                    </div>
                    <div id="eggButtonsStatusBadge" class="badge badge-success">2/2</div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 11px;">
                    <div style="padding: 8px; background: white; border-radius: 4px; text-align: center;">
                        <div style="margin-bottom: 4px;">Hn√≠zdo 1</div>
                        <div id="eggButton1Status" class="badge badge-secondary" style="font-size: 10px;">Idle
                        </div>
                        <button class="btn btn-danger btn-small" onclick="hardware.pressEggButton(1)"
                            style="margin-top: 6px; width: 100%; font-size: 10px; padding: 4px;">
                            ü•ö Simulovat vejce
                        </button>
                    </div>
                    <div style="padding: 8px; background: white; border-radius: 4px; text-align: center;">
                        <div style="margin-bottom: 4px;">Hn√≠zdo 2</div>
                        <div id="eggButton2Status" class="badge badge-secondary" style="font-size: 10px;">Idle
                        </div>
                        <button class="btn btn-danger btn-small" onclick="hardware.pressEggButton(2)"
                            style="margin-top: 6px; width: 100%; font-size: 10px; padding: 4px;">
                            ü•ö Simulovat vejce
                        </button>
                    </div>
                </div>
            </div>

            <!-- GSM Module SIM800L -->
            <div class="hardware-component"
                style="padding: 12px; background: #f3f4f6; border-radius: 8px; border: 1px solid #d1d5db; margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <div style="font-weight: 600; color: #374151; display: flex; align-items: center; gap: 6px;">
                        <span>üì∂</span> GSM SIM800L
                    </div>
                    <div id="gsmModuleStatusBadge" class="badge badge-success">OK</div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
                    <div>
                        <span style="color: #6b7280;">UART:</span>
                        <span id="gsmUartStatus" style="color: #1f2937;">GPIO 16/17</span>
                    </div>
                    <div>
                        <span style="color: #6b7280;">Baud:</span>
                        <span id="gsmBaudRate" style="color: #1f2937;">9600</span>
                    </div>
                </div>
                <div class="switch-item" style="margin-top: 8px; background: white; padding: 6px; border-radius: 4px;">
                    <span style="font-size: 11px;">Simulovat chybu GSM</span>
                    <label class="switch">
                        <input type="checkbox" id="gsmModuleError" onchange="hardware.setGsmError(this.checked)">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <!-- Pending Chickens (Unknown RFID Tags) -->
            <div class="hardware-component"
                style="padding: 12px; background: #fffbeb; border-radius: 8px; border: 1px solid #fde68a;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <div style="font-weight: 600; color: #b45309; display: flex; align-items: center; gap: 6px;">
                        <span>üêî</span> Pending Chickens
                    </div>
                    <div id="pendingChickensCount" class="badge badge-warning">0</div>
                </div>
                <div id="pendingChickensList" style="font-size: 12px; color: #78350f;">
                    <div style="text-align: center; padding: 8px; color: #9ca3af;">
                        ≈Ω√°dn√© nezn√°m√© tagy
                    </div>
                </div>
                <button class="btn btn-primary btn-small" onclick="hardware.simulateUnknownTag()"
                    style="width: 100%; margin-top: 8px; font-size: 11px;">
                    üè∑Ô∏è Simulovat nezn√°m√Ω RFID tag
                </button>
            </div>
        </div>

        <!-- Events Log Card -->
        <div class="card">
            <h2>üìù Event Log</h2>
            <div class="event-log" id="eventLog">
                <div class="event-item event-info">
                    <span class="event-time">--:--:--</span>
                    <span class="event-text">ƒåek√°m na p≈ôipojen√≠...</span>
                </div>
            </div>
            <button class="btn btn-secondary btn-small" onclick="logger.clear()" style="margin-top: 10px;">
                üóëÔ∏è Vymazat log
                <div class="camera-modal-title" id="cameraModalTitle">üì∏ Fotografie</div>
                <div class="camera-modal-subtitle" id="cameraModalSubtitle">-</div>
        </div>
        <button class="camera-modal-close" id="cameraModalClose">‚úñ</button>
    </div>
    <div class="camera-modal-body">
        <img id="cameraModalImage" alt="Snapshot detail" />
        <div class="camera-modal-overlay" id="cameraModalVideoOverlay">‚ñ∂Ô∏è</div>
    </div>
    <div class="camera-modal-actions">
        <button class="btn btn-danger" id="cameraModalDeleteBtn">üóëÔ∏è Smazat</button>
        <button class="btn btn-secondary" id="cameraModalDownloadBtn">‚¨áÔ∏è St√°hnout</button>
    </div>
    </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script src="js/logger.js"></script>
    <script src="js/credentials.js"></script>
    <script src="js/deviceAuth.js"></script>
    <script src="js/network.js"></script>
    <script src="js/hardware.js"></script>
    <script src="js/sensors.js"></script>
    <script src="js/door.js"></script>
    <script src="js/chickens.js"></script>
    <script src="js/feeder.js"></script>
    <script src="js/smart-counter.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/modules.js"></script>
    <script src="js/system.js"></script>
    <script src="js/simulator.js"></script>
    <script src="js/app.js"></script>
</body>

</html>
